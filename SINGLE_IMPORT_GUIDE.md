# 9.7数据汇总表单文件导入工具使用指南

## 📋 工具概述

专门为9.7数据汇总表设计的单文件导入工具，用于处理主批量导入过程中失败或遗漏的文件。

### 🔧 工具组件

1. **`import_single_9_7_file.mjs`** - 核心单文件导入脚本
2. **`run_single_import.sh`** - 管理和操作脚本
3. **`single_import.log`** - 详细导入日志

## 🚀 快速使用

### 基本命令
```bash
# 导入默认文件 (part_006)
./run_single_import.sh import

# 导入指定文件
./run_single_import.sh import 9.7数据汇总表-utf8_part_010.csv

# 检查所有9.7文件
./run_single_import.sh check

# 查看导入日志
./run_single_import.sh logs
```

### 直接使用核心脚本
```bash
# 导入默认文件
node import_single_9_7_file.mjs

# 导入指定文件
node import_single_9_7_file.mjs 9.7数据汇总表-utf8_part_020.csv

# 显示帮助
node import_single_9_7_file.mjs --help
```

## 📊 成功案例演示

### Part_006文件导入结果
```
🎉 9.7数据汇总表 part_006 文件单独导入成功！
══════════════════════════════════════════════════════════════════════
📊 导入结果摘要:
✅ 文件: 9.7数据汇总表-utf8_part_006.csv
📊 导入记录: 2,022 条
📦 处理分块: 11/11 (100%成功)
⏱️ 导入耗时: 3分26秒
🗄️ 数据库增长: 250,832 → 252,854 (+2,022条)
```

### 处理特点
- **智能分块**: 自动分为11个数据块处理
- **高成功率**: 100%分块成功率
- **重试机制**: 自动重试失败的操作
- **详细日志**: 完整的处理过程记录

## 🔧 功能特性

### ✅ 核心功能
- **单文件精确导入**: 针对特定文件进行导入
- **智能文件查找**: 自动查找和匹配相似文件
- **分块处理**: 根据文件大小动态调整分块策略
- **重试机制**: 失败操作自动重试，最多3次
- **详细日志**: 完整的导入过程记录
- **数据库状态**: 导入前后的记录数统计

### 🛠️ 管理功能
- **文件检查**: 扫描AI Drive中所有9.7文件
- **日志查看**: 查看最近的导入日志
- **日志清理**: 清理历史日志文件
- **帮助信息**: 完整的使用说明

## 📁 文件结构

### 脚本文件
```
webapp/
├── import_single_9_7_file.mjs    # 核心导入脚本
├── run_single_import.sh          # 管理脚本
└── single_import.log             # 导入日志
```

### 数据文件路径
```
/mnt/aidrive/9.7数据汇总表-utf8_part_XXX.csv
```

## 🎯 使用场景

### 1. 主导入失败文件补救
```bash
# 当主批量导入某个文件失败时
./run_single_import.sh import 9.7数据汇总表-utf8_part_006.csv
```

### 2. 新增文件导入
```bash
# 有新的9.7文件需要导入时
./run_single_import.sh import 9.7数据汇总表-utf8_part_101.csv
```

### 3. 重复导入验证
```bash
# 验证某个文件是否已正确导入
./run_single_import.sh import 9.7数据汇总表-utf8_part_050.csv
```

## 📊 性能参数

### 导入效率
- **平均处理时间**: 3-5分钟/文件 (约1000条记录)
- **分块大小**: 70-120条记录/分块 (动态调整)
- **重试次数**: 最多3次
- **分块间延迟**: 1.5秒

### 系统要求
- **内存使用**: < 50MB
- **CPU占用**: 低负载
- **网络连接**: 稳定的API连接
- **存储空间**: 足够的日志存储

## 🔍 故障排查

### 常见问题

#### 1. 文件不存在
```
❌ 文件不存在: /mnt/aidrive/9.7数据汇总表-utf8_part_XXX.csv
```
**解决方案**: 使用 `./run_single_import.sh check` 检查可用文件

#### 2. 登录失败
```
❌ 登录失败: 401 Unauthorized
```
**解决方案**: 检查生产环境URL和认证信息

#### 3. 网络超时
```
❌ 分块导入失败: fetch timeout
```
**解决方案**: 脚本会自动重试，等待完成即可

### 日志分析
```bash
# 查看详细错误日志
./run_single_import.sh logs

# 实时监控导入过程
tail -f single_import.log
```

## 📈 与主导入系统的协调

### 数据一致性
- 单文件导入与主导入系统使用相同的API端点
- 数据格式和处理逻辑完全一致
- 导入后的数据可以无缝集成

### 进度追踪
- 单文件导入不影响主系统的进度统计
- 可以与主系统并行运行
- 数据库状态实时更新

### 使用建议
1. **优先使用主导入系统** - 进行大规模批量导入
2. **使用单文件工具补救** - 处理失败或遗漏的文件
3. **定期检查文件状态** - 确保所有文件都已正确处理

## 🎉 总结

单文件导入工具成功解决了：
- ✅ **Part_006文件导入失败问题** - 成功导入2,022条记录
- ✅ **灵活的文件处理能力** - 支持任意9.7文件的单独导入
- ✅ **完善的错误处理** - 自动重试和详细日志
- ✅ **与主系统协调** - 无缝集成和数据一致性

**工具已就绪，可随时用于处理任何9.7数据汇总表文件的导入需求！**

---
*更新时间: 2025-09-08*  
*工具版本: v1.0*